"use strict";(self.webpackChunklukso_docs=self.webpackChunklukso_docs||[]).push([[5454],{3905:(e,t,n)=>{n.d(t,{Zo:()=>d,kt:()=>h});var s=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,s)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t){if(null==e)return{};var n,s,a=function(e,t){if(null==e)return{};var n,s,a={},r=Object.keys(e);for(s=0;s<r.length;s++)n=r[s],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(s=0;s<r.length;s++)n=r[s],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var l=s.createContext({}),c=function(e){var t=s.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},d=function(e){var t=c(e.components);return s.createElement(l.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return s.createElement(s.Fragment,{},t)}},u=s.forwardRef((function(e,t){var n=e.components,a=e.mdxType,r=e.originalType,l=e.parentName,d=o(e,["components","mdxType","originalType","parentName"]),u=c(n),h=a,m=u["".concat(l,".").concat(h)]||u[h]||p[h]||r;return n?s.createElement(m,i(i({ref:t},d),{},{components:n})):s.createElement(m,i({ref:t},d))}));function h(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var r=n.length,i=new Array(r);i[0]=u;var o={};for(var l in t)hasOwnProperty.call(t,l)&&(o[l]=t[l]);o.originalType=e,o.mdxType="string"==typeof e?e:a,i[1]=o;for(var c=2;c<r;c++)i[c]=n[c];return s.createElement.apply(null,i)}return s.createElement.apply(null,n)}u.displayName="MDXCreateElement"},7234:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>i,default:()=>p,frontMatter:()=>r,metadata:()=>o,toc:()=>c});var s=n(7462),a=(n(7294),n(3905));const r={sidebar_label:"Accept & Reject Assets",sidebar_position:2},i="Accept & Reject Assets",o={unversionedId:"guides/universal-receiver-delegate/accept-reject-assets",id:"guides/universal-receiver-delegate/accept-reject-assets",title:"Accept & Reject Assets",description:"Each user can create its own custom Universal Receiver Delegate contract that holds its own logic to be executed once the universalReceiver(..) function on his profile is called.",source:"@site/docs/guides/universal-receiver-delegate/accept-reject-assets.md",sourceDirName:"guides/universal-receiver-delegate",slug:"/guides/universal-receiver-delegate/accept-reject-assets",permalink:"/guides/universal-receiver-delegate/accept-reject-assets",draft:!1,editUrl:"https://github.com/lukso-network/docs/tree/main/docs/guides/universal-receiver-delegate/accept-reject-assets.md",tags:[],version:"current",lastUpdatedAt:1661109600,formattedLastUpdatedAt:"Aug 21, 2022",sidebarPosition:2,frontMatter:{sidebar_label:"Accept & Reject Assets",sidebar_position:2},sidebar:"guidesSidebar",previous:{title:"Set the default implementation",permalink:"/guides/universal-receiver-delegate/set-default-implementation"},next:{title:"Create an LSP7 Digital Asset (Token)",permalink:"/guides/digital-assets/create-lsp7-digital-asset"}},l={},c=[{value:"Rejecting all Assets",id:"rejecting-all-assets",level:2},{value:"Step1 - Deploy contract through Remix",id:"step1---deploy-contract-through-remix",level:3},{value:"Step2 - Set the address of the URD in the storage",id:"step2---set-the-address-of-the-urd-in-the-storage",level:3},{value:"Accepting specific Assets",id:"accepting-specific-assets",level:2}],d={toc:c};function p(e){let{components:t,...r}=e;return(0,a.kt)("wrapper",(0,s.Z)({},d,r,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"accept--reject-assets"},"Accept & Reject Assets"),(0,a.kt)("p",null,"Each user can create its own ",(0,a.kt)("strong",{parentName:"p"},"custom Universal Receiver Delegate")," contract that holds its own logic to be executed once the ",(0,a.kt)("strong",{parentName:"p"},(0,a.kt)("a",{parentName:"strong",href:"/standards/smart-contracts/lsp0-erc725-account#universalreceiver"},(0,a.kt)("inlineCode",{parentName:"a"},"universalReceiver(..)")))," function on his profile is called. "),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"LSP1UniversalReceiverDelegate-Guide",src:n(9427).Z,width:"2612",height:"1531"})),(0,a.kt)("h2",{id:"rejecting-all-assets"},"Rejecting all Assets"),(0,a.kt)("p",null,"In order to ",(0,a.kt)("strong",{parentName:"p"},"reject all the assets")," that are being transferred to the profile, we need to create a Universal Receiver Delegate contract that reverts when it's the case of asset transfer (LSP7 & LSP8). The ",(0,a.kt)("a",{parentName:"p",href:"/standards/smart-contracts/lsp0-erc725-account#universalreceiver"},(0,a.kt)("inlineCode",{parentName:"a"},"typeId"))," is the parameter that will give us more context on the call being made."),(0,a.kt)("p",null,(0,a.kt)("em",{parentName:"p"},"e.g.")),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"If ",(0,a.kt)("inlineCode",{parentName:"p"},"typeId")," is ",(0,a.kt)("strong",{parentName:"p"},(0,a.kt)("a",{parentName:"strong",href:"https://github.com/lukso-network/lsp-smart-contracts/blob/develop/contracts/LSP7DigitalAsset/LSP7Constants.sol#L13"},(0,a.kt)("inlineCode",{parentName:"a"},"0xdbe2c314e1aee2970c72666f2ebe8933a8575263ea71e5ff6a9178e95d47a26f")," _TYPEID_LSP7_TOKENSRECIPIENT")),", then we know that we are receiving an LSP7 Token.")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"If ",(0,a.kt)("inlineCode",{parentName:"p"},"typeId")," is ",(0,a.kt)("strong",{parentName:"p"},(0,a.kt)("a",{parentName:"strong",href:"https://github.com/lukso-network/lsp-smart-contracts/blob/develop/contracts/LSP8IdentifiableDigitalAsset/LSP8Constants.sol#L21"},(0,a.kt)("inlineCode",{parentName:"a"},"0xc7a120a42b6057a0cbed111fbbfbd52fcd96748c04394f77fc2c3adbe0391e01")," _TYPEID_LSP8_TOKENSRECIPIENT")),", then we know that we are receiving an LSP8 Token."))),(0,a.kt)("h3",{id:"step1---deploy-contract-through-remix"},"Step1 - Deploy contract through Remix"),(0,a.kt)("p",null,"The first step is to navigate to ",(0,a.kt)("strong",{parentName:"p"},(0,a.kt)("a",{parentName:"strong",href:"https://remix.ethereum.org/"},"Remix's website"))," and create a new solidity file under the ",(0,a.kt)("strong",{parentName:"p"},"contracts")," folder."),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"Creating Universal Receiver Delegate in Remix",src:n(7252).Z,width:"2998",height:"1334"})),(0,a.kt)("p",null,"After creating the ",(0,a.kt)("strong",{parentName:"p"},"UniversalReceiverDelegate.sol")," file, copy the code snippet below inside the file created. This code snippet will be responsible for rejecting all LSP7 & LSP8 assets being transferred to your profile."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-sol",metastring:'title="UniversalReceiverDelegate.sol - Solidity Code snippet of the URD that reject all assets"',title:'"UniversalReceiverDelegate.sol',"-":!0,Solidity:!0,Code:!0,snippet:!0,of:!0,the:!0,URD:!0,that:!0,reject:!0,all:!0,'assets"':!0},'// SPDX-License-Identifier: UNLICENSED\npragma solidity ^0.8.0;\n\n// This code is only used for guides puprose, it is working but not verified nor audited.\n\n// interfaces\nimport {LSP1UniversalReceiverDelegateUP} from "https://github.com/lukso-network/lsp-smart-contracts/blob/v0.6.2/contracts/LSP1UniversalReceiver/LSP1UniversalReceiverDelegateUP/LSP1UniversalReceiverDelegateUP.sol";\n\n// constants\nimport {_TYPEID_LSP7_TOKENSRECIPIENT} from "https://github.com/lukso-network/lsp-smart-contracts/blob/v0.6.2/contracts/LSP7DigitalAsset/LSP7Constants.sol";\nimport {_TYPEID_LSP8_TOKENSRECIPIENT} from "https://github.com/lukso-network/lsp-smart-contracts/blob/v0.6.2/contracts/LSP8IdentifiableDigitalAsset/LSP8Constants.sol";\n\ncontract CustomUniversalReceiverDelegate is LSP1UniversalReceiverDelegateUP  {\n\n    /**\n    * @param asset The address of the asset being transferred to the UniversalProfile.\n    * @param asset The address disallowing receiving assets.\n    */\n    error ReceivingAssetsNotAllowed(address asset, address recipient);\n\n    /**\n    * @dev Reverts when the typeId is relative to token receiving (LSP7 & LSP8) \n    * @param caller The address of the asset informing the `universalReceiver(..)` function on the UniversalProfile.\n    * @param value The amount of native tokens sent by the caller to the universalReceiver function on the UniversalProfile.\n    * @param typeId The typeId representing the context of the call to the universalReceiver function on the UniversalProfile.\n    * @param typeId The data sent to the universalReceiver function on the UniversalProfile.\n    */\n    function universalReceiverDelegate(\n        address caller,\n        uint256 value,\n        bytes32 typeId,\n        bytes memory data\n    ) public override returns (bytes memory result) {\n        if (typeId == _TYPEID_LSP7_TOKENSRECIPIENT || typeId == _TYPEID_LSP8_TOKENSRECIPIENT){\n            revert ReceivingAssetsNotAllowed(caller, msg.sender);\n        }\n    }\n}\n\n')),(0,a.kt)("p",null,"If you want the Universal Receiver Delegate to ",(0,a.kt)("strong",{parentName:"p"},"reject Vaults"),", you can add the LSP9 import statement and modify the if block to include the LSP9 typeId."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-sol"},'// constants\n// [..] other imports\nimport {_TYPEID_LSP9_VAULTRECIPIENT} from "https://github.com/lukso-network/lsp-smart-contracts/blob/v0.6.2/contracts/LSP9Vault/LSP9Constants.sol";\n\n// ...\n\nif(typeId == _TYPEID_LSP9_VAULTRECIPIENT || typeId == _TYPEID_LSP7_TOKENSRECIPIENT || typeId == _TYPEID_LSP8_TOKENSRECIPIENT){\n  revert ReceivingAssetsAndVaultsNotAllowed(caller, msg.sender); // also needs to be changed in the error reference\n}\n')),(0,a.kt)("admonition",{type:"note"},(0,a.kt)("p",{parentName:"admonition"},"Please make sure to unlock MetaMask and disable Browser Extension while doing this step.\n",(0,a.kt)("img",{alt:"Turning off Browser extension to use Remix Injected Provider",src:n(7482).Z,width:"3546",height:"1127"}))),(0,a.kt)("p",null,"After copying the code, navigate to the ",(0,a.kt)("strong",{parentName:"p"},"Solidity Compiler")," tab and press the Compile UniversalReceiverDelegate.sol button. Then navigate to the ",(0,a.kt)("strong",{parentName:"p"},"Deploy & Run Transactions")," tab and choose ",(0,a.kt)("em",{parentName:"p"},"Injected Provider")," as the environment."),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"Compiling contract in Remix",src:n(6046).Z,width:"2592",height:"1542"})),(0,a.kt)("p",null,"You should be connected to L16 in MetaMask and Remix and have enough LYXt in the EOA used to deploy the URD."),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"Connect to LUKSO L16 in Remix",src:n(5792).Z,width:"2619",height:"1527"})),(0,a.kt)("p",null,"After choosing the ",(0,a.kt)("strong",{parentName:"p"},"CustomUniversalReceiverDelegate")," contract in the ",(0,a.kt)("em",{parentName:"p"},"CONTRACT")," section and deploying, you'll confirm the transaction and wait until the transaction is confirmed and the contract is deployed on the network. Once deployed, you can copy the contract address to be used later when setting the address inside the storage."),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"Deploy and Copy the address in Remix",src:n(4293).Z,width:"2535",height:"1577"})),(0,a.kt)("h3",{id:"step2---set-the-address-of-the-urd-in-the-storage"},"Step2 - Set the address of the URD in the storage"),(0,a.kt)("p",null,"After deploying the contract, we need to set its address under the ",(0,a.kt)("strong",{parentName:"p"},(0,a.kt)("a",{parentName:"strong",href:"/standards/generic-standards/lsp1-universal-receiver#extension"},"LSP1-UniversalReceiverDelegate Data Key")),"."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-typescript",metastring:'title="Setting address of the URD in the storage"',title:'"Setting',address:!0,of:!0,the:!0,URD:!0,in:!0,'storage"':!0},"import Web3 from 'web3';\nimport constants from \"@lukso/lsp-smart-contracts/constants.js\";\nimport UniversalProfile from '@lukso/lsp-smart-contracts/artifacts/UniversalProfile.json';\nimport LSP6KeyManager from '@lukso/lsp-smart-contracts/artifacts/LSP6KeyManager.json';\n\nconst web3 = new Web3('https://rpc.l16.lukso.network');\n\nconst PRIVATE_KEY = '0x...'; // your EOA private key\nconst myEOA = web3.eth.accounts.wallet.add(PRIVATE_KEY);\n\nconst URD_DATA_KEY = constants.ERC725YKeys.LSP0.LSP1UniversalReceiverDelegate;\nconst myURDAddress = \"0x..\" // address of the URD Deployed in Step 1\nconst myUniversalProfileAddress = \"0x..\" // address of the UP\n\n// create an instance of the UP\nconst myUP = new web3.eth.Contract(UniversalProfile.abi, myUniversalProfileAddress);\n\n// encode setData Payload on the Vault\nconst setDataPayload = await myUP.methods[\n    \"setData(bytes32,bytes)\"\n  ](URD_DATA_KEY, myURDAddress).encodeABI(); \n\n// getting the Key Manager address from UP\nconst myKeyManagerAddress = await myUP.methods.owner().call();\n\n// create an instance of the KeyManager\nlet myKM = new web3.eth.Contract(LSP6KeyManager.abi, myKeyManagerAddress);\n\n// execute the executePayload on the KM\nawait myKM.methods.execute(executePayload).send({\n    from: myEOA.address,\n    gasLimit: 600_000,\n});\n")),(0,a.kt)("h2",{id:"accepting-specific-assets"},"Accepting specific Assets"),(0,a.kt)("p",null,"To accept specific assets, you should differentiate between the different assets being transferred to you. One way to do it is to have a mapping inside the URD contract that states if the asset being transferred ",(0,a.kt)("strong",{parentName:"p"},"is allowed to be received or not"),". Only the owner should be allowed to add these asset addresses. For simplicity, the owner could be the EOA address deploying the contract."),(0,a.kt)("p",null,"Repeat the deployment steps in ",(0,a.kt)("strong",{parentName:"p"},(0,a.kt)("a",{parentName:"strong",href:"#rejecting-all-assets"},"Rejecting all Assets"))," section and replace the solidity code with the one written below. "),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-sol",metastring:'title="Solidity Code snippet of the Custom URD that accept specific assets"',title:'"Solidity',Code:!0,snippet:!0,of:!0,the:!0,Custom:!0,URD:!0,that:!0,accept:!0,specific:!0,'assets"':!0},'// SPDX-License-Identifier: UNLICENSED\npragma solidity ^0.8.0;\n\n// This code is only used for guides puprose, it is working but not verified nor audited.\n\n// modules\nimport {LSP1UniversalReceiverDelegateUP} from "https://github.com/lukso-network/lsp-smart-contracts/blob/v0.6.2/contracts/LSP1UniversalReceiver/LSP1UniversalReceiverDelegateUP/LSP1UniversalReceiverDelegateUP.sol";\n\n// constants\nimport {_TYPEID_LSP7_TOKENSRECIPIENT} from "https://github.com/lukso-network/lsp-smart-contracts/blob/v0.6.2/contracts/LSP7DigitalAsset/LSP7Constants.sol";\nimport {_TYPEID_LSP8_TOKENSRECIPIENT} from "https://github.com/lukso-network/lsp-smart-contracts/blob/v0.6.2/contracts/LSP8IdentifiableDigitalAsset/LSP8Constants.sol";\n\ncontract CustomUniversalReceiverDelegate is LSP1UniversalReceiverDelegateUP  {\n\n    address immutable public owner;\n    mapping (address => bool) public allowedAssets;\n\n    constructor(address _owner){\n        owner = _owner;\n    }\n\n    modifier onlyOwner(){\n        require(msg.sender == owner, "CustomUniversalReceiverDelegate : Caller is not the owner");\n        _;\n    }\n\n\n    function setAllowedAssets(address assets) public onlyOwner {\n        allowedAssets[assets] = true;\n    }\n    /**\n    * @dev Reverts when the asset being transferred is not allowed. If allowed, the address of the asset\n    * will be registered inside the storage, and removed when balance of the asset equal 0, according to\n    * the LSP5-ReceivedAssers standard.\n    *\n    * @param caller The address of the asset informing the `universalReceiver(..)` function on the UniversalProfile.\n    * @param value The amount of native tokens sent by the caller to the universalReceiver function on the UniversalProfile.\n    * @param typeId The typeId representing the context of the call to the universalReceiver function on the UniversalProfile.\n    * @param typeId The data sent to the universalReceiver function on the UniversalProfile.\n    */\n    function universalReceiverDelegate(\n        address caller,\n        uint256 value,\n        bytes32 typeId,\n        bytes memory data\n    ) public override returns (bytes memory result){\n        // checking if the asset being transferred is allowed or not.\n        if(typeId == _TYPEID_LSP8_TOKENSRECIPIENT || typeId == _TYPEID_LSP7_TOKENSRECIPIENT){\n            require(allowedAssets[caller], "Asset being transferred is not allowed to be received");\n        }\n        // using the default implementation code to register the address of assets received\n        result = super.universalReceiverDelegate(caller, value, typeId, data);\n    }\n}\n')),(0,a.kt)("p",null,"The code above will register the address of the assets allowed and remove them when the UP's balance for this asset is equal to 0. It will also reject assets that are not allowed. Since this code will need ",(0,a.kt)("strong",{parentName:"p"},(0,a.kt)("a",{parentName:"strong",href:"/standards/universal-profile/lsp6-key-manager#permissions"},"SETDATA Permission")),", after deploying you will set the address of the URD in the storage using the code from the ",(0,a.kt)("strong",{parentName:"p"},(0,a.kt)("a",{parentName:"strong",href:"/guides/universal-receiver-delegate/set-default-implementation#set-the-address-of-the-urd-in-the-storage"},"Set the address of the URD in the storage"))," section."))}p.isMDXComponent=!0},9427:(e,t,n)=>{n.d(t,{Z:()=>s});const s=n.p+"assets/images/UniversalReceiverDelegate-Guide-f5859ba1a65be506a1333711bb641b64.jpeg"},6046:(e,t,n)=>{n.d(t,{Z:()=>s});const s=n.p+"assets/images/remix-compiling-contract-69306a722de7dc3402212a1d312c7200.jpeg"},5792:(e,t,n)=>{n.d(t,{Z:()=>s});const s=n.p+"assets/images/remix-connect-l16-668ec673f2583efbe8d42692a6bb692f.jpeg"},7252:(e,t,n)=>{n.d(t,{Z:()=>s});const s=n.p+"assets/images/remix-creating-file-623cd12b4561f01cd7a3ef09ba1acbd2.jpeg"},4293:(e,t,n)=>{n.d(t,{Z:()=>s});const s=n.p+"assets/images/remix-deploy-copy-address-ae34db3793706f0fb1371adea92ec97b.jpeg"},7482:(e,t,n)=>{n.d(t,{Z:()=>s});const s=n.p+"assets/images/turn-off-browser-extension-e670c855042852daeee4d33320b4e008.jpeg"}}]);