"use strict";(self.webpackChunklukso_docs=self.webpackChunklukso_docs||[]).push([[1083],{3905:(e,t,a)=>{a.d(t,{Zo:()=>d,kt:()=>u});var n=a(7294);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function i(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function s(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?i(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):i(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function o(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},i=Object.keys(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var l=n.createContext({}),c=function(e){var t=n.useContext(l),a=t;return e&&(a="function"==typeof e?e(t):s(s({},t),e)),a},d=function(e){var t=c(e.components);return n.createElement(l.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},m=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,i=e.originalType,l=e.parentName,d=o(e,["components","mdxType","originalType","parentName"]),m=c(a),u=r,h=m["".concat(l,".").concat(u)]||m[u]||p[u]||i;return a?n.createElement(h,s(s({ref:t},d),{},{components:a})):n.createElement(h,s({ref:t},d))}));function u(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=a.length,s=new Array(i);s[0]=m;var o={};for(var l in t)hasOwnProperty.call(t,l)&&(o[l]=t[l]);o.originalType=e,o.mdxType="string"==typeof e?e:r,s[1]=o;for(var c=2;c<i;c++)s[c]=a[c];return n.createElement.apply(null,s)}return n.createElement.apply(null,a)}m.displayName="MDXCreateElement"},6221:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>l,contentTitle:()=>s,default:()=>p,frontMatter:()=>i,metadata:()=>o,toc:()=>c});var n=a(7462),r=(a(7294),a(3905));const i={sidebar_label:"LSP1 - Universal Receiver Delegate",sidebar_position:2},s="LSP1 - Universal Receiver Delegate",o={unversionedId:"standards/generic-standards/lsp1-universal-receiver-delegate",id:"standards/generic-standards/lsp1-universal-receiver-delegate",title:"LSP1 - Universal Receiver Delegate",description:"LSP1 - Universal Receiver Delegate",source:"@site/docs/standards/generic-standards/lsp1-universal-receiver-delegate.md",sourceDirName:"standards/generic-standards",slug:"/standards/generic-standards/lsp1-universal-receiver-delegate",permalink:"/standards/generic-standards/lsp1-universal-receiver-delegate",draft:!1,editUrl:"https://github.com/lukso-network/docs/tree/main/docs/standards/generic-standards/lsp1-universal-receiver-delegate.md",tags:[],version:"current",lastUpdatedAt:1665125948,formattedLastUpdatedAt:"Oct 7, 2022",sidebarPosition:2,frontMatter:{sidebar_label:"LSP1 - Universal Receiver Delegate",sidebar_position:2},sidebar:"standardsSidebar",previous:{title:"LSP1 - Universal Receiver",permalink:"/standards/generic-standards/lsp1-universal-receiver"},next:{title:"LSP14 - Ownable 2-Step",permalink:"/standards/generic-standards/lsp14-ownable-2-step"}},l={},c=[{value:"Introduction",id:"introduction",level:2},{value:"What does this standard represent ?",id:"what-does-this-standard-represent-",level:2},{value:"Specification",id:"specification",level:3},{value:"How Delegation works",id:"how-delegation-works",level:3},{value:"Implementations",id:"implementations",level:2},{value:"Token transfer scenario",id:"token-transfer-scenario",level:3},{value:"References",id:"references",level:2}],d={toc:c};function p(e){let{components:t,...i}=e;return(0,r.kt)("wrapper",(0,n.Z)({},d,i,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"lsp1---universal-receiver-delegate"},"LSP1 - Universal Receiver Delegate"),(0,r.kt)("admonition",{title:"Standard Document",type:"info"},(0,r.kt)("p",{parentName:"admonition"},(0,r.kt)("a",{parentName:"p",href:"https://github.com/lukso-network/LIPs/blob/main/LSPs/LSP-1-UniversalReceiver.md#specification-of-the-universalreceiverdelegate"},"LSP1 - Universal Receiver Delegate"))),(0,r.kt)("admonition",{title:"Recommendation",type:"success"},(0,r.kt)("p",{parentName:"admonition"},"To better understand this standard, it is well-advised first to check the origin standard ",(0,r.kt)("strong",{parentName:"p"},(0,r.kt)("a",{parentName:"strong",href:"/standards/generic-standards/lsp1-universal-receiver"},"LSP1-UniversalReceiver")),".")),(0,r.kt)("h2",{id:"introduction"},"Introduction"),(0,r.kt)("p",null,"Once deployed, the code of a smart contract ",(0,r.kt)("strong",{parentName:"p"},"can not be changed"),". However, builders can decide how their smart contracts implement the ",(0,r.kt)("a",{parentName:"p",href:"/standards/smart-contracts/lsp0-erc725-account#universalreceiver"},(0,r.kt)("inlineCode",{parentName:"a"},"universalReceiver(...)"))," function. This standard allows any external smart contract to change relations from the main contract to change function behavior."),(0,r.kt)("p",null,"Therefore, it is advised not to hardcode how the smart contract should handle and react to specific calls inside the ",(0,r.kt)("inlineCode",{parentName:"p"},"universalReceiver(...)")," function. Instead, it should delegate this functionality to another external contract. Developers could then customize such contracts to implement a specific logic that is ",(0,r.kt)("strong",{parentName:"p"},"changeable anytime via an upgrade"),"."),(0,r.kt)("h2",{id:"what-does-this-standard-represent-"},"What does this standard represent ?"),(0,r.kt)("h3",{id:"specification"},"Specification"),(0,r.kt)("admonition",{title:"recommendation",type:"success"},(0,r.kt)("p",{parentName:"admonition"},"Smart contracts implementing the ",(0,r.kt)("a",{parentName:"p",href:"#"},"LSP1-UniversalReceiverDelegate")," standard SHOULD ",(0,r.kt)("strong",{parentName:"p"},"register")," the ",(0,r.kt)("strong",{parentName:"p"},(0,r.kt)("a",{parentName:"strong",href:"/standards/smart-contracts/interface-ids"},"LSP1UniversalReceiverDelegate InterfaceId")," using ERC165"),". This way, other contracts can be aware that the contract supports the LSP1 standard.")),(0,r.kt)("p",null,"This standard defines a contract called ",(0,r.kt)("strong",{parentName:"p"},"UniversalReceiverDelegate")," containing a single function named ",(0,r.kt)("inlineCode",{parentName:"p"},"universalReceiverDelegate(...)")," that should be called by the ",(0,r.kt)("inlineCode",{parentName:"p"},"universalReceiver(..)")," function with:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"address ",(0,r.kt)("inlineCode",{parentName:"p"},"caller"),": the address that initially called the ",(0,r.kt)("inlineCode",{parentName:"p"},"universalReceiver(...)")," function.")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"uint256 ",(0,r.kt)("inlineCode",{parentName:"p"},"value"),": the amount of value sent to the ",(0,r.kt)("inlineCode",{parentName:"p"},"universalReceiver(...)")," function.")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"bytes32 ",(0,r.kt)("inlineCode",{parentName:"p"},"typeId"),": the typeId passed to the ",(0,r.kt)("inlineCode",{parentName:"p"},"universalReceiver(...)")," function.")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"bytes ",(0,r.kt)("inlineCode",{parentName:"p"},"data"),": the data passed to the ",(0,r.kt)("inlineCode",{parentName:"p"},"universalReceiver(...)")," function."))),(0,r.kt)("h3",{id:"how-delegation-works"},"How Delegation works"),(0,r.kt)("p",null,"The address of the ",(0,r.kt)("strong",{parentName:"p"},(0,r.kt)("a",{parentName:"strong",href:"/standards/smart-contracts/lsp1-universal-receiver-delegate-up"},"UniversalReceiverDelegate"))," contract can be stored inside the storage of the contract delegating its ",(0,r.kt)("inlineCode",{parentName:"p"},"universalReceiver(...)")," functionality. This allows the upgrade of the ",(0,r.kt)("strong",{parentName:"p"},"UniversalReceiverDelegate")," simply by changing the address (in storage) to another UniversalReceiverDelegate containing a new logic."),(0,r.kt)("p",null,"If the contract implementing the ",(0,r.kt)("inlineCode",{parentName:"p"},"universalReceiver(..)")," supports ",(0,r.kt)("strong",{parentName:"p"},(0,r.kt)("a",{parentName:"strong",href:"https://github.com/ERC725Alliance/erc725/blob/main/docs/ERC-725.md#erc725y"},"ERC725Y Data key-value store")),", the address of the ",(0,r.kt)("strong",{parentName:"p"},"external contract")," MUST be set as a value for the ",(0,r.kt)("strong",{parentName:"p"},"LSP1UniversalReceiverDelegate data key")," shown below to enable the optional extension. This key-value pair will act as a reference, making this external contract upgradeable if required."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "name": "LSP1UniversalReceiverDelegate",\n  "key": "0x0cfc51aec37c55a4d0b1a65c6255c4bf2fbdf6277f3cc0730c45b828b6db8b47",\n  "keyType": "Singleton",\n  "valueType": "address",\n  "valueContent": "Address"\n}\n')),(0,r.kt)("p",null,"Check ",(0,r.kt)("strong",{parentName:"p"},(0,r.kt)("a",{parentName:"strong",href:"/standards/generic-standards/lsp2-json-schema"},"LSP2-ERC725YJSONSchema"))," for more information about the JSON schema."),(0,r.kt)("h2",{id:"implementations"},"Implementations"),(0,r.kt)("p",null,"There are several implementations of the standard. The ",(0,r.kt)("strong",{parentName:"p"},(0,r.kt)("a",{parentName:"strong",href:"/standards/smart-contracts/lsp1-universal-receiver-delegate-up"},"LSP1UniversalReceiverDelegateUP"))," contract is one of them and is used as a delegate to the ",(0,r.kt)("inlineCode",{parentName:"p"},"universalReceiver(...)")," function of ",(0,r.kt)("strong",{parentName:"p"},"UniversalProfile")," contract."),(0,r.kt)("p",null,"At the moment, this contract allows to:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"receive and send tokens & vaults"),(0,r.kt)("li",{parentName:"ul"},"register the data keys representing them according to ",(0,r.kt)("strong",{parentName:"li"},(0,r.kt)("a",{parentName:"strong",href:"https://github.com/lukso-network/LIPs/blob/main/LSPs/LSP-5-ReceivedAssets.md"},"LSP5-ReceivedAssets"))," and ",(0,r.kt)("strong",{parentName:"li"},(0,r.kt)("a",{parentName:"strong",href:"https://github.com/lukso-network/LIPs/blob/main/LSPs/LSP-10-ReceivedVaults.md"},"LSP10-ReceivedVaults"))," Standards.")),(0,r.kt)("h3",{id:"token-transfer-scenario"},"Token transfer scenario"),(0,r.kt)("p",null,"One of the possible scenarios is a token transfer between Alice and Bob. Alice wants to transfer a token owned by her Universal Profile to the Universal Profile of her friend Bob."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"1.")," It calls the ",(0,r.kt)("strong",{parentName:"p"},(0,r.kt)("inlineCode",{parentName:"strong"},"transfer(...)"))," function on the token contract through the ",(0,r.kt)("a",{parentName:"p",href:"/standards/smart-contracts/lsp6-key-manager"},"KeyManager"),"."),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"executing transfer function",src:a(4392).Z,width:"1542",height:"648"})),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"2.")," The ",(0,r.kt)("inlineCode",{parentName:"p"},"transfer(...)")," function on the token contract will directly ",(0,r.kt)("strong",{parentName:"p"},"trigger a hook")," that will call the ",(0,r.kt)("inlineCode",{parentName:"p"},"universalReceiver(...)")," function on both sender and recipient Universal Profiles."),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"token contract hooks calling universalReceiver function",src:a(7015).Z,width:"1706",height:"585"})),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"3.")," 3. If the ",(0,r.kt)("strong",{parentName:"p"},"UniversalReceiverDelegate")," contract is set, it will be called by the ",(0,r.kt)("inlineCode",{parentName:"p"},"universalReceiver(...)")," function and will execute its custom logic."),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"universalReceiver function calling UniversalReceiverDelegate contract",src:a(5223).Z,width:"1358",height:"736"})),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"4.")," The ",(0,r.kt)("strong",{parentName:"p"},"UniversalReceiverDelegate")," of ",(0,r.kt)("strong",{parentName:"p"},"Universal Profile")," allows the transfer and set ",(0,r.kt)("strong",{parentName:"p"},(0,r.kt)("a",{parentName:"strong",href:"https://github.com/lukso-network/LIPs/blob/main/LSPs/LSP-5-ReceivedAssets.md"},"LSP5-ReceivedAssets"))," data keys on both Profiles through the KeyManager."),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"UniversalReceiverDelegate setting data keys on profile",src:a(1704).Z,width:"1410",height:"610"})),(0,r.kt)("h2",{id:"references"},"References"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://github.com/lukso-network/LIPs/blob/main/LSPs/LSP-1-UniversalReceiver.md"},"LUKSO Standards Proposals: LSP1 - Universal Receiver (Standard Specification, GitHub)")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://github.com/lukso-network/lsp-universalprofile-smart-contracts/tree/develop/contracts/LSP1UniversalReceiver"},"LSP1 Universal Receiver: Solidity implementations (GitHub)"))))}p.isMDXComponent=!0},4392:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/token-transfer-1-ee415d051d1dd02035f140209e18d455.jpg"},7015:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/token-transfer-2-0b3dd968027ecc8d6cb4b6973063ae1e.jpg"},5223:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/token-transfer-3-12192e22a67a38d9d9c9dfc5bbd7ee1d.jpg"},1704:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/token-transfer-4-7db56efafbc48ac08f9d8a37985e31de.jpg"}}]);